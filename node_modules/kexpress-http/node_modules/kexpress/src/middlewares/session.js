'use strict';

const session = require('express-session');
const MongoStore = require('connect-mongo')(session);

function getSession(mongoConfig) {
    let mongoUrl = '';
    if (mongoConfig.options.user && mongoConfig.options.pass) {
        mongoUrl = `mongodb://${mongoConfig.options.user}:${mongoConfig.options.pass}@${mongoConfig.host}:${mongoConfig.port}/${mongoConfig.db}`;
    }
    else {
        mongoUrl = `mongodb://${mongoConfig.host}:${mongoConfig.port}/${mongoConfig.db}`;
    }

    const httpSession = session({
        resave: true,
        secret: '123456',
        key: 'user_sample',
        cookie: {
            maxAge: 1000 * 60 * 60 * 24 * 30
        },
        saveUninitialized: true,
        store: new MongoStore({
            url: mongoUrl,
            ttl: 14 * 24 * 60 * 60,
            autoRemove: 'interval',
            autoRemoveInterval: 10
        })
    });

    return httpSession;
}

module.exports = {
    getSession
};
